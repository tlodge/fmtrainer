(this.webpackJsonpfmtrainer=this.webpackJsonpfmtrainer||[]).push([[0],{25:function(t,e,n){t.exports=n(57)},30:function(t,e,n){},31:function(t,e,n){t.exports=n.p+"static/media/logo.8dad8028.svg"},5:function(t,e,n){t.exports={row:"Counter_row__1C_4f",value:"Counter_value__1d0te",button:"Counter_button__1xpSV",textbox:"Counter_textbox__3ODaX",asyncButton:"Counter_asyncButton__2UAr3 Counter_button__1xpSV"}},56:function(t,e,n){},57:function(t,e,n){"use strict";n.r(e);var o=n(0),r=n.n(o),a=n(8),i=n.n(a),c=(n(30),n(31),n(4)),s=n(1),u=n(7),l=Object(u.b)({name:"counter",initialState:{value:0},reducers:{increment:function(t){t.value+=1},decrement:function(t){t.value-=1},incrementByAmount:function(t,e){t.value+=e.payload}}}),d=l.actions,f=(d.increment,d.decrement,d.incrementByAmount,l.reducer);n(5);var g=n(6),m=n.n(g),I=function(t){m()({method:"get",url:encodeURIComponent("/record/".concat(t))})},N={NOT_LISTENING:"not listening",AWAITING_GESTURE:"awaiting gesture",AWAITING_CONFIRMATION:"awaiting confirmation",FIVE:"5",FOUR:"4",THREE:"3",TWO:"2",ONE:"1",RECORDING:"recording",TRAINING:"training",TESTING:"testing"},T=["FIVE","FOUR","THREE","TWO","ONE","RECORDING"],O={NOT_LISTENING:"press button to start listening for instructions",AWAITING_GESTURE:"say <strong>record</strong> followed by the <strong><i>name of the gesture</i></strong> you'd like to train",AWAITING_CONFIRMATION:"say <strong>ready</strong> to start recording a gesture with this name or <strong>cancel</strong> to restate gesture",FIVE:"recording in <strong>five</strong> seconds...",FOUR:"recording in <strong>four</strong> seconds...",THREE:"recording in <strong>three</strong> seconds...",TWO:"recording in <strong>two</strong> seconds...",ONE:"recording in <strong>one</strong> second!",RECORDING:"record gesture, say <strong>ok</strong> or <strong>done</strong> when done, or <strong>cancel</strong> to discard",TRAINING:"now training...this will take a while...",TESTING:"now testing what we have learnt!"},E=Object(u.b)({name:"train",initialState:{amListening:!1,status:N.NOT_LISTENING,instructions:O.NOT_LISTENING,gesture:"",rawTranscript:"",preview:!1,classification:"unknown"},reducers:{setInstructions:function(t,e){t.instructions=e.payload},setStatus:function(t,e){t.status=N[e.payload],t.instructions=O[e.payload]},setPreview:function(t,e){t.preview=e.payload},setRawTranscript:function(t,e){t.rawTranscript=e.payload},setClassification:function(t,e){t.classification=e.payload},reset:function(t,e){t.status=N.AWAITING_GESTURE,t.instructions=O.AWAITING_GESTURE,t.gesture="",t.preview=!1},startedListening:function(t,e){e.payload?(t.amFinished=!1,t.amListening=!0,t.status=N.AWAITING_GESTURE,t.instructions=O.AWAITING_GESTURE):(t.status=N.NOT_LISTENING,t.instructions=O.NOT_LISTENING)},issueConfirm:function(t,e){t.readytorecord="yes"===e.payload.toLowerCase()},setGesture:function(t,e){if(""!==e.payload.trim()){var n=e.payload.toLowerCase().indexOf("record");-1!==n&&(t.gesture="".concat(e.payload.substring(n+6).trim()),t.status=N.AWAITING_CONFIRMATION,t.instructions=O.AWAITING_CONFIRMATION)}}}}),p=E.actions,w=p.setGesture,v=p.setStatus,b=p.startedListening,h=(p.amListening,p.reset),_=p.setRawTranscript,R=p.setPreview,S=p.setInstructions,y=p.setClassification,G=function(t){return t.train.gesture},A=function(t){return t.train.status},C=function(t){return t.train.instructions},j=function(t){return t.train.amListening},L=function(t){return t.train.rawTranscript},x=function(t){return t.train.preview},k=function(t){return t.train.classification},W=function(t){return function(e,n){var o=n().train;return e(_(t.toLowerCase().trim())),"test"===t.toLowerCase().trim()?(e(v("TESTING")),void e(R(!0))):("mark"===t.toLowerCase().trim()&&(console.log("marking"),console.log("calling mark!"),m()({method:"get",url:"/mark"})),"end"===t.toLowerCase().trim()&&(console.log("end mark"),console.log("calling END mark!"),m()({method:"get",url:"/endmark"})),"train"===t.toLowerCase().trim()&&o.status!=N.TRAINING?(e(h()),e(v("TRAINING")),void function(t,e){var n=new EventSource("/trains");n.onopen=function(){console.log("connection successfully opened!!")},n.onerror=function(t){console.log("error connecting",t),n.close()},n.onmessage=function(o){-1!==o.data.indexOf("StreamExecutor")||-1!==o.data.indexOf("COMPLETE")?(console.log("FINISHED TRAINING"),e(),n.close()):t(o.data)}}((function(t){e(S(t))}),(function(){e(h())}))):-1!==["done","ok"].indexOf(t.toLowerCase().trim())?(e(h()),void m()({method:"get",url:"/done"})):"cancel"!==t.toLowerCase().trim()?o.status===N.AWAITING_CONFIRMATION&&"ready"===t.toLowerCase().trim()?(e(v("RECORDING_COUNTDOWN")),void e(F(o))):void e(w(t)):void e(h()))}},F=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return function(o){o(v(T[n])),5==n&&(console.log("calling record with ",e),o(R(!1)),I(e.gesture)),n<5&&(o(R(!0)),setTimeout((function(){return t(e,++n)(o)}),1e3))}},U=E.reducer,D=n(13),M=n.n(D),B=n(24),H=function(){var t=Object(B.a)(M.a.mark((function t(){return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.getUserMedia({audio:!1,video:!0});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),V=function(t){var e=Object(o.useState)(!1),n=Object(c.a)(e,2),r=n[0],a=n[1],i=Object(o.useState)(null),s=Object(c.a)(i,2),u=s[0],l=s[1],d=Object(o.useState)(""),f=Object(c.a)(d,2),g=f[0],m=f[1],I=Object(o.useState)(!0),N=Object(c.a)(I,2),T=N[0],O=N[1];return Object(o.useEffect)((function(){!u&&t.current&&(t.current instanceof HTMLVideoElement&&l(t.current))}),[t,u]),function(t){var e=Object(o.useRef)(t);Object(o.useEffect)((function(){e.current=t}),[t]),Object(o.useEffect)((function(){return function(){}}),[])}(u),Object(o.useEffect)((function(){u&&!r&&T&&H().then((function(t){u.srcObject=t,a(!0)})).catch((function(t){m(t.message),O(!1)}))}),[u,r,T]),Object(o.useEffect)((function(){var e=t.current;T?e.play():e.pause()}),[T,t]),[u,r,T,O,g]},P=n(9),z=n.n(P);function J(){var t="undefined"!==typeof window&&(window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.msSpeechRecognition||window.oSpeechRecognition),e=t?new t:null;e.continous=!0,e.interimResults=!0,e.lang="en-US";var n=Object(o.useState)(),a=Object(c.a)(n,2),i=(a[0],a[1],Object(s.c)(G)),u=Object(s.c)(C),l=Object(s.c)(j),d=Object(s.c)(L),f="recording"===Object(s.c)(A),g=Object(s.c)(x),I=Object(s.c)(k),T=Object(s.b)(),O="",E="";e.onend=function(){O="",e.start()},e.onresult=function(t){E="";for(var e=t.resultIndex;e<t.results.length;e++){var n=t.results[e][0].transcript;t.results[e].isFinal?O+=n+" ":T(W(E+=n))}T(W(O))};var p=Object(o.createRef)(),w=Object(o.createRef)(),v=V(p),h=Object(c.a)(v,5),_=(h[0],h[1],h[2],h[3],h[4],function(t,e){setInterval((function(){var n;t.getContext("2d").drawImage(e,0,0,128,128),T((n=t.toDataURL("image/png"),function(t,e){var o=e().train;o.status===N.RECORDING&&m()({method:"post",url:"/image",data:{image:n}}),o.status===N.TESTING&&m()({method:"post",url:"/classify",data:{image:n}}).then((function(e){console.log("setting classidficaton",e.data);var n=e.data.category;t(y(void 0===n?"unknown":n))}))}))}),1e3)});return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{padding:"0px 100px 100px 100px"}},r.a.createElement(r.a.Fragment,null,r.a.createElement("video",{style:{display:f||g?"block":"none"},ref:p,autoPlay:!0,muted:!0,controls:!0,width:600,height:400}),r.a.createElement("canvas",{style:{display:"none"},ref:w,width:128,height:128}),g&&"unknown"!=I.trim()&&r.a.createElement("div",{className:z.a.classification},I)),r.a.createElement("div",{style:{fontSize:80,fontWeight:700,textTransform:"uppercase",marginBottom:30}},i),l&&r.a.createElement("div",{style:{color:"#736A6A"},dangerouslySetInnerHTML:{__html:u}}),!l&&r.a.createElement("button",{id:"microphone-btn",className:z.a.button,onClick:function(){O="",console.log("in handle listener: am listening",l),l||(T(b(!0)),_(w.current,p.current),console.log("OK STARTING LISTENING!"),e.start())}},"START LISTENING")),""!=d.trim()&&r.a.createElement("div",{className:z.a.footer},'"'.concat(d,'"')))}n(56);var K=function(){return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement(J,null)))},X=Object(u.a)({reducer:{counter:f,train:U}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(s.a,{store:X},r.a.createElement(K,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))},9:function(t,e,n){t.exports={button:"Train_button__2wHuI",footer:"Train_footer__WmYe4",classification:"Train_classification__1znlx"}}},[[25,1,2]]]);
//# sourceMappingURL=main.d9c8a803.chunk.js.map